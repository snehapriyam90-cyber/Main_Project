{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Kisan Fresh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            background-color: #f5f7fa;
            font-family: 'Segoe UI', sans-serif;
        }
        .topbar {
            height: 70px;
            background: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: fixed;
            width: 100%;
            z-index: 1000;
        }
        .brand h1 { font-size: 36px; color: #b71c1c; margin:0; }
        .brand p { font-size: 14px; color: #8a6d6d; margin:0; }
        .top-icons i { font-size: 22px; color: #b71c1c; margin-left: 20px; cursor: pointer; }

        .sidebar {
            position: sticky;
            top: 70px;
            width: 250px;
            height: calc(100vh - 70px);
            background: linear-gradient(270deg, #ff8a80, #e53935, #b71c1c);
            background-size: 400% 400%;
            animation: gradientMove 6s ease infinite;
            padding-top: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        @keyframes gradientMove { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
        .sidebar a { color: #fff; display: block; text-decoration: none; padding: 12px 25px; font-weight:500; transition: all 0.3s;}
        .sidebar a:hover { background-color: rgba(255,255,255,0.2); padding-left: 35px; }
        .sidebar i { margin-right: 10px; }

        .content { flex:1; padding: 30px; }
        .dashboard-wrapper { display: flex; padding-top: 70px; min-height: calc(100vh - 70px); }
        .card-box { background:white; border-radius:15px; padding:25px; box-shadow:0 4px 15px rgba(0,0,0,0.08); }
        .footer-section { background: linear-gradient(135deg,#8b1e1e,#c62828); color:#fdeaea; font-family:'Poppins',sans-serif; }
        .footer-title { font-family:'Playfair Display',serif; font-size:26px; color:#fff; }
        .footer-heading { font-size:18px; margin-bottom:12px; color:#ffd6d6; }
        .footer-text { font-size:14px; color:#fdeaea; }
        .footer-links { list-style:none; padding:0; }
        .footer-links li { margin-bottom:8px; }
        .footer-links a { color:#fdeaea; text-decoration:none; transition: all 0.3s ease; }
        .footer-links a:hover { color:#fff; padding-left:5px; }
        .footer-bottom { background-color:#6a1515; font-size:14px; color:#ffeaea; text-align:center; padding:10px 0; }
        /* Pulse animation for background gradient */
    @keyframes pulse {
        0% { background-position: 0% 50%; }
        50% { background-position: 50% 50%; }
        100% { background-position: 100% 50%; }
    }
    .welcome-card {
        background-size: 200% 200%;
        transition: transform 0.3s ease;
    }
    .welcome-card:hover {
        transform: scale(1.05);
    }

    /* Optional: Animate.css fadeIn (if you want smoother text animations) */
    @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');
    </style>
</head>

<body>
<div class="page-wrapper">

<!-- TOPBAR -->
<div class="topbar">
    <div class="brand">
        <h1>Kisan Fresh</h1>
        <p>Admin Control Panel</p>
    </div>
    <div class="top-icons d-flex align-items-center">
        <!-- Notifications -->
        <div class="dropdown me-3">
            <a href="#" data-bs-toggle="dropdown">
                <i class="bi bi-bell position-relative">
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ notifications|length }}</span>
                </i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow" style="width:320px; max-height:400px; overflow-y:auto;">
                <li class="dropdown-header fw-semibold text-danger">Notifications</li>
                {% if notifications %}
                    {% for note in notifications %}
                        <li>
                            <a href="{{ note.link|default:'#' }}" class="dropdown-item">
                                {{ note.message }}<br>
                                <small class="text-muted">{{ note.created_at|date:"d M, h:i A" }}</small>
                            </a>
                        </li>
                    {% endfor %}
                {% else %}
                    <li><span class="dropdown-item text-muted">No notifications</span></li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li><a href="{% url 'admin_notifications' %}" class="dropdown-item text-center text-danger fw-semibold">View all</a></li>
            </ul>
        </div>

        <!-- Settings -->
        <div class="dropdown">
            <a href="#" class="dropdown-toggle" data-bs-toggle="dropdown">
                <i class="bi bi-gear-fill"></i> <span class="text-danger fw-semibold">Settings</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end shadow">
                <li><a class="dropdown-item" href="{% url 'admin_password_change' %}">Change Admin Password</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="/logout/">Logout</a></li>
            </ul>
        </div>
    </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard-wrapper">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <a href="{% url 'admin_dashboard' %}"><i class="bi bi-speedometer2"></i> Dashboard</a>
        <a href="{% url 'admin_farmer_management' %}"><i class="bi bi-people-fill"></i> Farmer Management</a>
        <a href="{% url 'admin_customers' %}"><i class="bi bi-person-lines-fill"></i> Customer Management</a>
        <a href="{% url 'admin_product_management' %}"><i class="bi bi-basket-fill"></i> Products</a>
        <a href="{% url 'admin_orders' %}"><i class="bi bi-box-seam"></i> Orders</a>
        <a href="{% url 'admin_review_management' %}"><i class="bi bi-star-fill"></i> Reviews</a>
        <a href="{% url 'admin_sales_report' %}"><i class="bi bi-bar-chart-fill"></i> Sales & Reports</a>
        <a href="{% url 'admin_system_activity' %}"><i class="bi bi-activity"></i> System Activity</a>
        <a href="{% url 'admin_contact_queries' %}"><i class="bi bi-envelope-fill"></i>Queries</a>
    </div>

    <!-- CONTENT -->
    <div class="content">
        {% block content %}
        <div class="container-fluid py-4">
            <div class="card shadow-lg text-white rounded-4 mb-4 p-5 text-center welcome-card" 
     style="background: linear-gradient(135deg, #b71c1c, #f44336); animation: pulse 3s infinite alternate;">
    <h2 class="fw-bold mb-2 animate__animated animate__fadeInDown">
        Welcome back, {{ request.user.first_name|default:request.user.username }}!
    </h2>
    <p class="mb-0 fs-5 animate__animated animate__fadeInUp">
        Here's the latest overview of your platform.
    </p>
</div>

        <!-- KPI CARDS -->
        <div class="row g-4 mb-4">
            {% for kpi in kpi_cards %}
            <div class="col-xl-2 col-lg-4 col-md-6">
                <div class="card shadow-sm border-0 rounded-4 p-3 text-center">
                    <i class="bi bi-{{ kpi.icon }} text-{{ kpi.color }} fs-3"></i>
                    <h6 class="mt-2">{{ kpi.title }}</h6>
                    <h4 class="fw-bold text-{{ kpi.color }}">{{ kpi.value }}</h4>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- QUICK ACTIONS -->
        <div class="row g-3 mb-4 text-center">
        <div class="col">
            <a href="{% url 'admin_farmer_management' %}" class="btn btn-outline-success btn-lg w-100 shadow-sm rounded-pill">Approve Farmers</a>
        </div>
        <div class="col">
            <a href="{% url 'admin_orders' %}" class="btn btn-outline-primary btn-lg w-100 shadow-sm rounded-pill">Orders</a>
        </div>
        <div class="col">
            <a href="{% url 'admin_review_management' %}" class="btn btn-outline-warning btn-lg w-100 shadow-sm rounded-pill">Reviews</a>
        </div>
        <div class="col">
            <a href="{% url 'admin_sales_report' %}" class="btn btn-outline-info btn-lg w-100 shadow-sm rounded-pill">Sales</a>
        </div>
        <div class="col">
            <a href="{% url 'admin_system_activity' %}" class="btn btn-outline-dark btn-lg w-100 shadow-sm rounded-pill">Logs</a>
        </div>
    </div>


        <!-- ACTIVITY + ORDER STATUS -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-header bg-light fw-bold">Recent Activity</div>
                    <ul class="list-group list-group-flush">
                        {% for order in recent_orders %}
                        <li class="list-group-item">
                            Order {{ order.id }} ‚Üí {{ order.status|capfirst }}
                        </li>
                        {% empty %}
                        <li class="list-group-item text-muted">No activity</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-header bg-light fw-bold">Order Status</div>
                    <div class="card-body">
                        <canvas id="orderChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

<!-- ================= TOP PRODUCTS + ALERTS ================= -->
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card shadow-lg rounded-4 p-3">
                <h5 class="fw-bold mb-3 text-primary">Top Products</h5>
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                        <tr><th>Sl No</th><th>Product</th><th>Revenue</th></tr>
                    </thead>
                    <tbody>
                        {% for p in top_products %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ p.name }}</td>
                            <td>‚Çπ {{ p.revenue|floatformat:2 }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="3" class="text-center text-muted">No data</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-lg rounded-4 p-3">
                <h5 class="fw-bold mb-3 text-danger">Alerts</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center text-danger">
                        Pending Farmers
                        <span class="badge bg-danger rounded-pill">{{ pending_farmers }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center text-warning">
                        Total Earnings
                        <span class="badge bg-warning rounded-pill">{{ total_earnings }}</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

         <!-- ================= TOP FARMERS ================= -->
    <div class="card shadow-lg rounded-4 p-3 mb-4">
        <h5 class="fw-bold mb-3 text-primary">Top Farmers</h5>
        <table class="table table-striped table-hover mb-0">
            <thead class="table-light">
                <tr><th>Sl No</th><th>Farmer</th><th>Earnings</th></tr>
            </thead>
            <tbody>
                {% for f in top_farmers %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ f.name }}</td>
                    <td>‚Çπ {{ f.revenue|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="3" class="text-center text-muted">No data</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

        </div>

        <!-- CHART DATA -->
        <script id="order-status-labels" type="application/json">{{ status_labels_json|safe }}</script>
        <script id="order-status-counts" type="application/json">{{ status_counts_json|safe }}</script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const labels = JSON.parse(document.getElementById("order-status-labels").textContent);
            const dataCounts = JSON.parse(document.getElementById("order-status-counts").textContent);
            const ctx = document.getElementById("orderChart").getContext("2d");
            new Chart(ctx, {
                type: "doughnut",
                data: { labels: labels, datasets: [{ data: dataCounts, backgroundColor: ["#198754","#0d6efd","#ffc107","#dc3545","#6c757d"], borderWidth:1 }]},
                options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:"bottom" } } }
            });
        </script>

        {% endblock %}
    </div>
</div>

<!-- FOOTER -->
<footer class="footer-section">
    <div class="container">
        <div class="row py-5">
            <div class="col-md-4 mb-4">
                <h3 class="footer-title">Kisan Fresh</h3>
                <p class="footer-text">Fresh fruits and vegetables directly from farmers to your home.
                    Quality, trust and freshness guaranteed.</p>
            </div>
            <div class="col-md-2 mb-4">
                <h5 class="footer-heading">Quick Links</h5>
                <ul class="footer-links">
                    <li><a href="{% url 'global_search' %}">Search</a></li>
                    <li><a href="{% url 'product_list' %}">Products</a></li>
                    <li><a href="{% url 'about' %}">About</a></li>
                </ul>
            </div>
            <div class="col-md-3 mb-4">
                <h5 class="footer-heading">Policies</h5>
                <ul class="footer-links">
                    <li><a href="{% url 'privacy_policy' %}">Privacy Policy</a></li>
                    <li><a href="{% url 'refund_policy' %}">Refund Policy</a></li>
                    <li><a href="{% url 'terms_conditions' %}">Terms & Conditions</a></li>
                </ul>
            </div>
            <div class="col-md-3 mb-4">
                <h5 class="footer-heading">Contact</h5>
                <p class="footer-text mb-1">üìç Kochi, Kerala, India</p>
                <p class="footer-text mb-1">üìß support@kisanfresh.com</p>
                <p class="footer-text">üìû +91 6238073192</p>
            </div>
        </div>
    </div>
    <div class="footer-bottom">¬© {% now "Y" %} <strong>Kisan Fresh</strong>. All Rights Reserved.</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
